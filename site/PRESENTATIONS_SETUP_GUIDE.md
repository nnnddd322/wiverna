# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–π

## üéØ –ö–æ–Ω—Ç—Ä–∞–∫—Ç –¥–∞–Ω–Ω—ã—Ö

### –°—Ç–∞—Ç—É—Å—ã (—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–æ –º–µ–∂–¥—É –ë–î/—Ñ—Ä–æ–Ω—Ç–æ–º/–∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä–æ–º)
- `processing` - —Ñ–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω, –∏–¥–µ—Ç –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è (default –ø–æ—Å–ª–µ upload)
- `ready` - —Å–ª–∞–π–¥—ã –≥–æ—Ç–æ–≤—ã, `slides_data` –∑–∞–ø–æ–ª–Ω–µ–Ω
- `error` - –æ—à–∏–±–∫–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏, —Å–º. `error_message`

**‚ùå –ù–ï–¢ —Å—Ç–∞—Ç—É—Å–∞ `pending`** - –æ–Ω —É–±—Ä–∞–Ω –∏–∑ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤.

### –§–æ—Ä–º–∞—Ç –ø—É—Ç–µ–π –≤ Storage bucket `presentations`
```
<lectureId>/source.pptx              # –ò—Å—Ö–æ–¥–Ω—ã–π PPTX —Ñ–∞–π–ª
<lectureId>/slides/001.png           # –°–ª–∞–π–¥ 1
<lectureId>/slides/002.png           # –°–ª–∞–π–¥ 2
...
<lectureId>/thumb.png                # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –ø—Ä–µ–≤—å—é
```

**–ë–ï–ó** –ø—Ä–µ—Ñ–∏–∫—Å–∞ `presentations/` –≤–Ω—É—Ç—Ä–∏ bucket - –æ–Ω —É–∂–µ –≤ –∏–º–µ–Ω–∏ bucket.

### –§–æ—Ä–º–∞—Ç `slides_data` (JSONB)
```json
{
  "pageCount": 20,
  "slides": [
    {
      "index": 1,
      "path": "<lectureId>/slides/001.png",
      "width": 1920,
      "height": 1080
    },
    {
      "index": 2,
      "path": "<lectureId>/slides/002.png",
      "width": 1920,
      "height": 1080
    }
  ]
}
```

---

## üìù –®–∞–≥ 1: –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é

–í—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ Supabase SQL Editor:

```bash
# –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª
cat supabase/migrations/20260108_presentations_delta.sql
```

–≠—Ç–∞ –º–∏–≥—Ä–∞—Ü–∏—è:
- ‚úÖ –°–æ–∑–¥–∞–µ—Ç/–æ–±–Ω–æ–≤–ª—è–µ—Ç —Ç–∞–±–ª–∏—Ü—É `presentations` —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –∫–æ–ª–æ–Ω–∫–∞–º–∏
- ‚úÖ –î–æ–±–∞–≤–ª—è–µ—Ç UNIQUE constraint –Ω–∞ `lecture_id` (1:1 —Å–≤—è–∑—å)
- ‚úÖ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç CHECK constraint –¥–ª—è —Å—Ç–∞—Ç—É—Å–æ–≤: `processing | ready | error`
- ‚úÖ –°–æ–∑–¥–∞–µ—Ç bucket `presentations` (–µ—Å–ª–∏ –Ω–µ—Ç)
- ‚úÖ –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç RLS –ø–æ–ª–∏—Ç–∏–∫–∏:
  - –ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–∏: INSERT/UPDATE/DELETE —Å WITH CHECK
  - –°—Ç—É–¥–µ–Ω—Ç—ã: SELECT —Å —É—á–µ—Ç–æ–º –¥–æ—Å—Ç—É–ø–∞ –ø–æ –≥—Ä—É–ø–ø–∞–º
- ‚úÖ –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç Storage policies –¥–ª—è teacher (upload/update/delete)
- ‚úÖ –ü—É–±–ª–∏—á–Ω—ã–π READ –¥–ª—è –≤—Å–µ—Ö (—Å—Ç—É–¥–µ–Ω—Ç—ã –≤–∏–¥—è—Ç —Å–ª–∞–π–¥—ã)
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –æ–±—â—É—é —Ñ—É–Ω–∫—Ü–∏—é `update_updated_at_column` –µ—Å–ª–∏ –µ—Å—Ç—å

**–í–∞–∂–Ω–æ:** –ú–∏–≥—Ä–∞—Ü–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–∞ –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Ç–∞–±–ª–∏—Ü—ã - –æ–Ω–∞ –¥–æ–±–∞–≤–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–µ–¥–æ—Å—Ç–∞—é—â–µ–µ.

---

## üîß –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### Frontend (`.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞)
```env
VITE_SUPABASE_URL=https://your-project.supabase.co
VITE_SUPABASE_ANON_KEY=your-anon-key
VITE_CONVERTER_URL=http://localhost:8787
```

### Converter (`converter/.env`)
```env
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key
PORT=8787
```

‚ö†Ô∏è **–ö—Ä–∏—Ç–∏—á–Ω–æ:** Converter –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `SUPABASE_SERVICE_ROLE_KEY`, –ù–ï anon key!

---

## üöÄ –®–∞–≥ 3: –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã

### –í–∞—Ä–∏–∞–Ω—Ç A: Docker Compose (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# –ò–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞
docker-compose up

# –ò–ª–∏ –≤ —Ñ–æ–Ω–µ
docker-compose up -d

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
docker-compose logs -f converter
```

–î–æ—Å—Ç—É–ø:
- Frontend: http://localhost:5173
- Converter: http://localhost:8787

### –í–∞—Ä–∏–∞–Ω—Ç B: –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

**Frontend:**
```bash
npm install
npm run dev
```

**Converter:**
```bash
cd converter
npm install
npm start
```

---

## ‚úÖ –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É

### 4.1 –ü—Ä–æ–≤–µ—Ä–∏—Ç—å converter
```bash
curl http://localhost:8787/health
```

–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:
```json
{
  "status": "ok",
  "service": "presentation-converter",
  "timestamp": "2026-01-08T..."
}
```

### 4.2 –ü—Ä–æ–≤–µ—Ä–∏—Ç—å bucket
1. –û—Ç–∫—Ä–æ–π—Ç–µ Supabase Dashboard ‚Üí Storage
2. –î–æ–ª–∂–µ–Ω –±—ã—Ç—å bucket `presentations` (public)
3. –ü–æ–∫–∞ –ø—É—Å—Ç–æ–π - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ

### 4.3 –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É
```sql
-- –í SQL Editor
SELECT * FROM presentations;
```

–ü–æ–∫–∞ –ø—É—Å—Ç–∞—è - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ. –ó–∞–ø–∏—Å–∏ –ø–æ—è–≤—è—Ç—Å—è –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ PPTX.

### 4.4 –ü—Ä–æ–≤–µ—Ä–∏—Ç—å RLS –ø–æ–ª–∏—Ç–∏–∫–∏
```sql
-- –î–æ–ª–∂–Ω—ã –±—ã—Ç—å 2 –ø–æ–ª–∏—Ç–∏–∫–∏ –Ω–∞ presentations
SELECT * FROM pg_policies WHERE tablename = 'presentations';

-- –î–æ–ª–∂–Ω—ã –±—ã—Ç—å 4 –ø–æ–ª–∏—Ç–∏–∫–∏ –Ω–∞ storage.objects –¥–ª—è bucket presentations
SELECT * FROM pg_policies 
WHERE tablename = 'objects' 
AND definition LIKE '%presentations%';
```

---

## üéì –®–∞–≥ 5: –¢–µ—Å—Ç–æ–≤—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π

### –ö–∞–∫ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å:

1. **–°–æ–∑–¥–∞—Ç—å –ª–µ–∫—Ü–∏—é-–ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—é:**
   - –í–æ–π—Ç–∏ –∫–∞–∫ teacher
   - –°–æ–∑–¥–∞—Ç—å –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—É (–µ—Å–ª–∏ –Ω–µ—Ç)
   - –î–æ–±–∞–≤–∏—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª ‚Üí –≤—ã–±—Ä–∞—Ç—å —Ç–∏–ø "–ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è"
   - –û—Ç–∫—Ä—ã—Ç—å —Å–æ–∑–¥–∞–Ω–Ω—É—é –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—é

2. **–ó–∞–≥—Ä—É–∑–∏—Ç—å PPTX:**
   - –£–≤–∏–¥–∏—Ç–µ —ç–∫—Ä–∞–Ω "–ó–∞–≥—Ä—É–∑–∏—Ç–µ –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—é"
   - –ù–∞–∂–∞—Ç—å "–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª PPTX"
   - –í—ã–±—Ä–∞—Ç—å .pptx —Ñ–∞–π–ª (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ç–µ—Å—Ç–æ–≤—É—é –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—é –Ω–∞ 5-10 —Å–ª–∞–π–¥–æ–≤)
   - –£–≤–∏–¥–∏—Ç–µ "–ó–∞–≥—Ä—É–∑–∫–∞..." ‚Üí "–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—é"

3. **–î–æ–∂–¥–∞—Ç—å—Å—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏:**
   - –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã
   - –ß–µ—Ä–µ–∑ 10-60 —Å–µ–∫—É–Ω–¥ (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–∞–∑–º–µ—Ä–∞) –ø–æ—è–≤—è—Ç—Å—è —Å–ª–∞–π–¥—ã
   - –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ - —É–≤–∏–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º

4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–ª–∞–π–¥—ã:**
   - –ù–∞–≤–∏–≥–∞—Ü–∏—è —Å—Ç—Ä–µ–ª–∫–∞–º–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
   - –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞: ‚Üê ‚Üí Space Enter
   - –ó—É–º +/- —Ä–∞–±–æ—Ç–∞–µ—Ç (50%-200%)
   - Fullscreen —Ä–∞–±–æ—Ç–∞–µ—Ç
   - –°—á–µ—Ç—á–∏–∫ "3 / 20" –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è

5. **–ü–µ—Ä–µ–∑–∞–ª–∏—Ç—å PPTX:**
   - –ù–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É Upload –≤ —Ç–æ–ø-–±–∞—Ä–µ (–∏–∫–æ–Ω–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏)
   - –í—ã–±—Ä–∞—Ç—å –Ω–æ–≤—ã–π —Ñ–∞–π–ª
   - –°—Ç–∞—Ä—ã–µ —Å–ª–∞–π–¥—ã —É–¥–∞–ª—è—Ç—Å—è, –∑–∞–≥—Ä—É–∑—è—Ç—Å—è –Ω–æ–≤—ã–µ

### –ö–∞–∫ —Å—Ç—É–¥–µ–Ω—Ç:

1. **–û—Ç–∫—Ä—ã—Ç—å –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—É:**
   - –í–æ–π—Ç–∏ –∫–∞–∫ student
   - –û—Ç–∫—Ä—ã—Ç—å –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—É —Å –¥–æ—Å—Ç—É–ø–æ–º (–∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–º –∏–ª–∏ –ø–æ –≥—Ä—É–ø–ø–µ)
   - –£–≤–∏–¥–µ—Ç—å –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—é –≤ —Å–ø–∏—Å–∫–µ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤

2. **–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–ª–∞–π–¥—ã:**
   - –ö–ª–∏–∫–Ω—É—Ç—å –Ω–∞ –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—é
   - –ï—Å–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–¥—ë—Ç ‚Üí —É–≤–∏–¥–µ—Ç—å "–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º..."
   - –ï—Å–ª–∏ –≥–æ—Ç–æ–≤–æ ‚Üí —É–≤–∏–¥–µ—Ç—å —Å–ª–∞–π–¥—ã
   - –õ–∏—Å—Ç–∞—Ç—å, –∑—É–º–∏—Ç—å, fullscreen

3. **–ï—Å–ª–∏ –æ—à–∏–±–∫–∞:**
   - –£–≤–∏–¥–µ—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
   - –û–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—é

---

## üêõ Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: "–°–µ—Ä–≤–∏—Å –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"

**–ü—Ä–∏—á–∏–Ω–∞:** Converter –Ω–µ –∑–∞–ø—É—â–µ–Ω –∏–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π URL.

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ converter —Ä–∞–±–æ—Ç–∞–µ—Ç
curl http://localhost:8787/health

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è
echo $VITE_CONVERTER_URL  # –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å http://localhost:8787

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å converter
docker-compose restart converter
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è –∑–∞—Å—Ç—Ä—è–ª–∞ –≤ "processing"

**–ü—Ä–∏—á–∏–Ω–∞:** –û—à–∏–±–∫–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –∏–ª–∏ converter –Ω–µ –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ Supabase.

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ converter
docker-compose logs converter

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è converter
docker-compose exec converter env | grep SUPABASE

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è service_role key, –Ω–µ anon key
```

**–¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ –≤ –ª–æ–≥–∞—Ö:**
- `Failed to download PPTX` ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å bucket –∏ RLS
- `LibreOffice conversion failed` ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ LibreOffice —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
- `Permission denied` ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å service_role key

### –ü—Ä–æ–±–ª–µ–º–∞: –°—Ç—É–¥–µ–Ω—Ç –Ω–µ –≤–∏–¥–∏—Ç –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—é

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–µ –∏–ª–∏ RLS –±–ª–æ–∫–∏—Ä—É–µ—Ç.

**–†–µ—à–µ–Ω–∏–µ:**
```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø —Å—Ç—É–¥–µ–Ω—Ç–∞
SELECT * FROM discipline_access 
WHERE student_id = '<student-uuid>' 
   OR group_id = (SELECT group_id FROM profiles WHERE id = '<student-uuid>');

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ª–µ–∫—Ü–∏—è published
SELECT * FROM lectures WHERE id = '<lecture-uuid>';
```

### –ü—Ä–æ–±–ª–µ–º–∞: –°–ª–∞–π–¥—ã –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è (–ø—É—Å—Ç–æ–π —ç–∫—Ä–∞–Ω)

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—É—Ç–∏ –≤ `slides_data` –∏–ª–∏ —Ñ–∞–π–ª—ã –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã.

**–†–µ—à–µ–Ω–∏–µ:**
```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å slides_data
SELECT slides_data FROM presentations WHERE lecture_id = '<lecture-uuid>';

-- –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
-- {"pageCount": 5, "slides": [{"index": 1, "path": "<lectureId>/slides/001.png", ...}]}
```

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∞–π–ª—ã –≤ Storage —á–µ—Ä–µ–∑ Supabase Dashboard
# Storage ‚Üí presentations ‚Üí <lectureId> ‚Üí slides ‚Üí –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å 001.png, 002.png...
```

### –ü—Ä–æ–±–ª–µ–º–∞: "Permission denied" –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ PPTX

**–ü—Ä–∏—á–∏–Ω–∞:** RLS –ø–æ–ª–∏—Ç–∏–∫–∞ –±–ª–æ–∫–∏—Ä—É–µ—Ç INSERT.

**–†–µ—à–µ–Ω–∏–µ:**
```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å –≤–ª–∞–¥–µ–µ—Ç –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–æ–π
SELECT d.* FROM disciplines d
JOIN lectures l ON l.discipline_id = d.id
WHERE l.id = '<lecture-uuid>'
AND d.teacher_id = auth.uid();

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–ª–∏—Ç–∏–∫—É
SELECT * FROM pg_policies 
WHERE tablename = 'presentations' 
AND policyname LIKE '%Teachers%';
```

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –≤—Å–µ—Ö –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–π
```sql
SELECT 
  p.id,
  l.title as lecture_title,
  p.status,
  p.error_message,
  p.slides_data->>'pageCount' as slide_count,
  p.created_at,
  p.updated_at
FROM presentations p
JOIN lectures l ON l.id = p.lecture_id
ORDER BY p.updated_at DESC;
```

### –ù–∞–π—Ç–∏ –∑–∞–≤–∏—Å—à–∏–µ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏
```sql
SELECT * FROM presentations
WHERE status = 'processing'
AND updated_at < NOW() - INTERVAL '10 minutes';
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑–º–µ—Ä Storage
```sql
SELECT 
  bucket_id,
  COUNT(*) as file_count,
  pg_size_pretty(SUM(metadata->>'size')::bigint) as total_size
FROM storage.objects
WHERE bucket_id = 'presentations'
GROUP BY bucket_id;
```

---

## üîÑ –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤—Ä—É—á–Ω—É—é

–ï—Å–ª–∏ –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è –∑–∞–≤–∏—Å–ª–∞ –∏–ª–∏ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å:

```sql
-- –°–±—Ä–æ—Å–∏—Ç—å —Å—Ç–∞—Ç—É—Å –Ω–∞ processing
UPDATE presentations 
SET status = 'processing', 
    error_message = NULL,
    slides_data = NULL
WHERE lecture_id = '<lecture-uuid>';
```

–ó–∞—Ç–µ–º –≤—ã–∑–≤–∞—Ç—å converter API:
```bash
curl -X POST http://localhost:8787/convert \
  -H "Content-Type: application/json" \
  -d '{"lectureId": "<lecture-uuid>"}'
```

---

## ‚ú® –ì–æ—Ç–æ–≤–æ!

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —à–∞–≥–æ–≤:
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ `presentations` –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞
- ‚úÖ Bucket `presentations` —Å–æ–∑–¥–∞–Ω
- ‚úÖ RLS –ø–æ–ª–∏—Ç–∏–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ Converter –∑–∞–ø—É—â–µ–Ω –∏ –¥–æ—Å—Ç—É–ø–µ–Ω
- ‚úÖ Frontend –ø–æ–¥–∫–ª—é—á–µ–Ω –∫ converter
- ‚úÖ –ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å PPTX
- ‚úÖ –°—Ç—É–¥–µ–Ω—Ç –º–æ–∂–µ—Ç –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —Å–ª–∞–π–¥—ã
- ‚úÖ –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—é

**–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:**
1. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª–Ω—ã–π flow —Å —Ä–µ–∞–ª—å–Ω—ã–º PPTX —Ñ–∞–π–ª–æ–º
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –¥–æ—Å—Ç—É–ø–∞ –ø–æ –≥—Ä—É–ø–ø–∞–º
3. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏ –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã
4. –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –¥–æ–±–∞–≤–∏—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é thumbnail (–ø–µ—Ä–≤—ã–π —Å–ª–∞–π–¥)

**–ü–æ–¥–¥–µ—Ä–∂–∫–∞:**
- –õ–æ–≥–∏ converter: `docker-compose logs -f converter`
- –õ–æ–≥–∏ frontend: –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12)
- SQL –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –≤—ã—à–µ
