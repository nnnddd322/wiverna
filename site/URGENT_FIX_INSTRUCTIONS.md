# üö® –°–†–û–ß–ù–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –û–®–ò–ë–û–ö

## –ü—Ä–æ–±–ª–µ–º—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å:

1. ‚ùå **–û—à–∏–±–∫–∞ 404**: RPC —Ñ—É–Ω–∫—Ü–∏—è `validate_teacher_secret` –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
2. ‚ùå **–û—à–∏–±–∫–∞ 500**: –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —Ç–∞–±–ª–∏—Ü–µ `groups` –¥–ª—è —á—Ç–µ–Ω–∏—è
3. ‚ùå **–û—à–∏–±–∫–∞ 401**: RLS –±–ª–æ–∫–∏—Ä—É–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª–µ–π –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
4. ‚ùå **–ü—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ –≥—Ä—É–ø–ø**: –ì—Ä—É–ø–ø—ã –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤ —Ñ–æ—Ä–º–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
5. ‚ùå **–°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á**: –§—É–Ω–∫—Ü–∏—è –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–ª—é—á "1"

## üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é

### –®–∞–≥ 1: –û—Ç–∫—Ä–æ–π—Ç–µ Supabase SQL Editor

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://supabase.com
2. –û—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **SQL Editor** (–ª–µ–≤–æ–µ –º–µ–Ω—é)

### –®–∞–≥ 2: –í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL —Å–∫—Ä–∏–ø—Ç

**–í–ê–ñ–ù–û:** –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª **`FIX_SUPABASE_ISSUES.sql`**, —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ **–í–ï–°–¨** –µ–≥–æ —Å–æ–¥–µ—Ä–∂–∏–º—ã–π –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –≤ SQL Editor, –∑–∞—Ç–µ–º –Ω–∞–∂–º–∏—Ç–µ **Run**.

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –í–∫–ª—é—á–∏—Ç RLS –¥–ª—è –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü
- –°–æ–∑–¥–∞—Å—Ç RPC —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–µ–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞
- –ò—Å–ø—Ä–∞–≤–∏—Ç –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞ –¥–ª—è `groups` (—Ä–∞–∑—Ä–µ—à–∏—Ç —á—Ç–µ–Ω–∏–µ –≤—Å–µ–º)
- –ò—Å–ø—Ä–∞–≤–∏—Ç –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞ –¥–ª—è `profiles` (—Ä–∞–∑—Ä–µ—à–∏—Ç —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏)
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á "1"
- –°–æ–∑–¥–∞—Å—Ç —Ç–µ—Å—Ç–æ–≤—ã–µ –≥—Ä—É–ø–ø—ã

–ò–ª–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—ã –≤—Ä—É—á–Ω—É—é:

#### 2.1. –°–æ–∑–¥–∞–π—Ç–µ RPC —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–µ–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞

```sql
CREATE OR REPLACE FUNCTION public.validate_teacher_secret(secret TEXT)
RETURNS BOOLEAN
LANGUAGE plpgsql
SECURITY DEFINER
AS $$
DECLARE
  stored_secret TEXT;
BEGIN
  SELECT value INTO stored_secret
  FROM public.system_settings
  WHERE key = 'teacher_secret';
  
  RETURN stored_secret = secret;
END;
$$;
```

#### 2.2. –ò—Å–ø—Ä–∞–≤—å—Ç–µ RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã groups

```sql
-- –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –ø–æ–ª–∏—Ç–∏–∫–∏
DROP POLICY IF EXISTS "Authenticated users can read groups" ON public.groups;
DROP POLICY IF EXISTS "Only admins can manage groups" ON public.groups;
DROP POLICY IF EXISTS "Anyone can read groups" ON public.groups;

-- –í–ê–ñ–ù–û: –†–∞–∑—Ä–µ—à–∞–µ–º –í–°–ï–ú (–¥–∞–∂–µ –Ω–µ–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–º) —á–∏—Ç–∞—Ç—å –≥—Ä—É–ø–ø—ã
CREATE POLICY "Anyone can read groups"
ON public.groups
FOR SELECT
TO public
USING (true);

-- –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω—ã –º–æ–≥—É—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å
CREATE POLICY "Only admins can manage groups"
ON public.groups
FOR ALL
TO authenticated
USING (
  EXISTS (
    SELECT 1 FROM public.profiles
    WHERE profiles.id = auth.uid()
    AND profiles.role = 'admin'
  )
);
```

#### 2.3. –ò—Å–ø—Ä–∞–≤—å—Ç–µ RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã profiles

```sql
-- –£–¥–∞–ª—è–µ–º –≤—Å–µ —Å—Ç–∞—Ä—ã–µ –ø–æ–ª–∏—Ç–∏–∫–∏
DROP POLICY IF EXISTS "Users can read own profile" ON public.profiles;
DROP POLICY IF EXISTS "Users can update own profile" ON public.profiles;
DROP POLICY IF EXISTS "Admins can update profiles" ON public.profiles;
DROP POLICY IF EXISTS "Teachers and admins can read student profiles" ON public.profiles;
DROP POLICY IF EXISTS "Users can insert own profile" ON public.profiles;
DROP POLICY IF EXISTS "Allow profile creation during signup" ON public.profiles;

-- –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –†–∞–∑—Ä–µ—à–∞–µ–º —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
CREATE POLICY "Allow profile creation during signup"
ON public.profiles
FOR INSERT
TO authenticated
WITH CHECK (auth.uid() = id);

-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç —á–∏—Ç–∞—Ç—å —Å–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å
CREATE POLICY "Users can read own profile"
ON public.profiles
FOR SELECT
TO authenticated
USING (auth.uid() = id);

-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å —Å–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å
CREATE POLICY "Users can update own profile"
ON public.profiles
FOR UPDATE
TO authenticated
USING (auth.uid() = id);

-- –ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–∏ –∏ –∞–¥–º–∏–Ω—ã –º–æ–≥—É—Ç —á–∏—Ç–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª–∏ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
CREATE POLICY "Teachers and admins can read student profiles"
ON public.profiles
FOR SELECT
TO authenticated
USING (
  EXISTS (
    SELECT 1 FROM public.profiles p
    WHERE p.id = auth.uid()
    AND p.role IN ('teacher', 'admin')
  )
);
```

#### 2.4. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω

```sql
-- –û–±–Ω–æ–≤–ª—è–µ–º —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –Ω–∞ "1"
UPDATE public.system_settings
SET value = '1'
WHERE key = 'teacher_secret';

-- –ï—Å–ª–∏ –∑–∞–ø–∏—Å–∏ –Ω–µ—Ç, —Å–æ–∑–¥–∞–µ–º
INSERT INTO public.system_settings (key, value)
VALUES ('teacher_secret', '1')
ON CONFLICT (key) DO UPDATE
SET value = '1';
```

#### 2.5. –ü–µ—Ä–µ—Å–æ–∑–¥–∞–π—Ç–µ –≥—Ä—É–ø–ø—ã

```sql
-- –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –≥—Ä—É–ø–ø—ã
DELETE FROM public.groups;

-- –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–µ –≥—Ä—É–ø–ø—ã
INSERT INTO public.groups (name)
VALUES 
  ('–ü–ò-21'),
  ('–ü–ò-22'),
  ('–ò–°-21'),
  ('–ò–í–¢-21'),
  ('–ò–í–¢-22');
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–í—ã–ø–æ–ª–Ω–∏—Ç–µ –ø—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã:

```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞
SELECT key, value FROM public.system_settings WHERE key = 'teacher_secret';

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥—Ä—É–ø–ø
SELECT * FROM public.groups;

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ RPC —Ñ—É–Ω–∫—Ü–∏–∏
SELECT public.validate_teacher_secret('1');
-- –î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å: true
```

### –®–∞–≥ 4: –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

1. –í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –Ω–∞–∂–º–∏—Ç–µ `Ctrl+C` —á—Ç–æ–±—ã –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å dev —Å–µ—Ä–≤–µ—Ä
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–Ω–æ–≤–∞: `npm run dev -- --host`
3. –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:5173

### –®–∞–≥ 5: –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è

**–ö–∞–∫ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å:**
- –í–∫–ª—é—á–∏—Ç–µ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å "–Ø –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å"
- –í–≤–µ–¥–∏—Ç–µ —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á: `1`
- –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è
- –ù–∞–∂–º–∏—Ç–µ "–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è"

**–ö–∞–∫ —Å—Ç—É–¥–µ–Ω—Ç:**
- –í—ã–∫–ª—é—á–∏—Ç–µ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å "–Ø –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å"
- –í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É –∏–∑ —Å–ø–∏—Å–∫–∞ (–¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –ü–ò-21, –ü–ò-22, –ò–°-21)
- –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è
- –ù–∞–∂–º–∏—Ç–µ "–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è"

## ‚úÖ –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å:

- ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è —Å —Å–µ–∫—Ä–µ—Ç–Ω—ã–º –∫–ª—é—á–æ–º "1"
- ‚úÖ –í—ã–±–æ—Ä –≥—Ä—É–ø–ø—ã –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Å—Ç—É–¥–µ–Ω—Ç–∞ (—Å–ø–∏—Å–æ–∫ –±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω)
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –≤ –ë–î –±–µ–∑ –æ—à–∏–±–∫–∏ 401
- ‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫ 404, 401 –∏ 500 –≤ –∫–æ–Ω—Å–æ–ª–∏
- ‚úÖ –ì—Ä—É–ø–ø—ã –≤–∏–¥–Ω—ã –≤ –≤—ã–ø–∞–¥–∞—é—â–µ–º —Å–ø–∏—Å–∫–µ

## üîß –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã –æ—Å—Ç–∞—é—Ç—Å—è:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—Å–µ SQL –∫–æ–º–∞–Ω–¥—ã –≤—ã–ø–æ–ª–Ω–∏–ª–∏—Å—å –±–µ–∑ –æ—à–∏–±–æ–∫
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ Table Editor ‚Üí groups, —á—Ç–æ –≥—Ä—É–ø–ø—ã —Å–æ–∑–¥–∞–Ω—ã
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ Table Editor ‚Üí system_settings, —á—Ç–æ teacher_secret = "1"
4. –û—á–∏—Å—Ç–∏—Ç–µ –∫—ç—à –±—Ä–∞—É–∑–µ—Ä–∞ (Ctrl+Shift+Delete)
5. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å Ctrl+F5

## üìû –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

–í—Å–µ SQL –∫–æ–º–∞–Ω–¥—ã –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ —Ñ–∞–π–ª–µ: **`FIX_SUPABASE_ISSUES.sql`**

–ü—Ä–æ—Å—Ç–æ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤–µ—Å—å —Ñ–∞–π–ª –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –≤ SQL Editor Supabase, –∑–∞—Ç–µ–º –Ω–∞–∂–º–∏—Ç–µ "Run".
